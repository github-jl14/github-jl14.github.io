<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> </title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .login-box, .content-box { text-align: center; margin-top: 50px; }
        input[type="text"] { padding: 10px; width: 80%; margin-bottom: 10px; }
        button { padding: 10px 20px; cursor: pointer; }
        .image-grid { display: none; flex-wrap: wrap; gap: 10px; }
        .image-grid img { width: 200px; height: 150px; object-fit: cover; cursor: pointer; }
        .notice { margin-top: 20px; padding: 10px; border: 1px solid #ccc; display: none; }

        /* Modal styles */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.8); 
            justify-content: center; 
            align-items: center;
        }
        .modal-content { 
            position: relative; 
            max-width: 90vw; 
            max-height: 90vh; 
            margin: auto; 
            background: #fff;
        }
        .modal-content img { 
            width: 100%; 
            height: auto; 
        }
        .close { 
            position: absolute; 
            top: 10px; 
            right: 25px; 
            color: #fff; 
            font-size: 35px; 
            font-weight: bold; 
            cursor: pointer;
        }
        .modal-content button { 
            position: absolute; 
            top: 50%; 
            background: rgba(0,0,0,0.6); 
            color: #fff; 
            border: none; 
            padding: 10px; 
            cursor: pointer;
        }
        .prev { 
            left: 0;
            position: absolute;
            opacity: 50%;
        }
        .next { 
            right: -5; 
            opacity: 50%;
        }
    </style>
</head>
<body>

<h1><p id="header">Enter Access Key</p></h1>
<div class="login-box">
    <input type="number" id="accessKey" placeholder="7-character key">
    <button onclick="login()">Submit</button>
</div>

<div class="content-box">
    <h2>Folder: <span id="folderName"></span></h2>
    <div class="image-grid" id="imageGrid"></div>
    <div class="notice" id="notice"></div>
</div>

<!-- Modal for images -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <button class="prev" onclick="changeImage(-1)">&#10094;</button>
        <img id="modalImage" src="">
        <button class="next" onclick="changeImage(1)">&#10095;</button>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const folderName = urlParams.get('name');
    
    document.getElementById('folderName').innerText = folderName;

    function cleanKey(key) {
        return key.replace(/[\r\n]+/gm, '').trim();
    }

    function login() {
        const enteredKey = cleanKey(document.getElementById('accessKey').value);

        fetch(`../ans/keys/${folderName}.txt`)
            .then(response => response.text())
            .then(correctKey => {
                const cleanCorrectKey = cleanKey(correctKey);

                if (enteredKey === cleanCorrectKey) {
                    displayFolderContents(folderName);
                    document.getElementById("header").innerText = `Answers inside /${folderName}`
                } else {
                    alert('Invalid access key!');
                }
            });
    }

    function displayFolderContents(folderName) {
        document.querySelector('.login-box').style.display = 'none';
        document.querySelector('.content-box').style.display = 'block';
        document.querySelector('.image-grid').style.display = 'flex';
        document.querySelector('.notice').style.display = 'block';

        const images = ["pic.jpg", "pic2.jpg", "pic3.jpg"];  // Replace with actual filenames
        const imageGrid = document.getElementById('imageGrid');
        
        imageGrid.innerHTML = ''; // Clear any existing images

        images.forEach((img, index) => {
            const imgElem = document.createElement('img');
            imgElem.src = `${folderName}/${img}`;
            imgElem.onclick = () => openModal(index);  // Set click event to open the modal
            imageGrid.appendChild(imgElem);
        });

        fetch(`${folderName}/notice.txt`)
            .then(response => response.text())
            .then(text => {
                document.getElementById('notice').innerText = text;
            });
    }

    // Modal functionality
    let currentImageIndex = 0;
    const images = ["pic.jpg", "pic2.jpg", "pic3.jpg"];  // Replace with actual filenames. Hardcoded file names coz Github doesn't have dynamic logics

    function openModal(index) {
        currentImageIndex = index;
        document.getElementById('modalImage').src = `${folderName}/${images[currentImageIndex]}`;
        document.getElementById('myModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    function changeImage(direction) {
        currentImageIndex = (currentImageIndex + direction + images.length) % images.length;
        document.getElementById('modalImage').src = `${folderName}/${images[currentImageIndex]}`;
    }

    window.onclick = function(event) {
        if (event.target === document.getElementById('myModal')) {
            closeModal();
        }
    }
</script>

</body>
</html>