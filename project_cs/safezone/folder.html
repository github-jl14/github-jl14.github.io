<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folder Access</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .login-box, .content-box { text-align: center; margin-top: 50px; }
        input[type="text"] { padding: 10px; width: 80%; margin-bottom: 10px; }
        button { padding: 10px 20px; cursor: pointer; }
        .image-grid { display: none; flex-wrap: wrap; gap: 10px; }
        .image-grid img { width: 200px; height: 150px; object-fit: cover; }
        .notice { margin-top: 20px; padding: 10px; border: 1px solid #ccc; display: none; }
    </style>
</head>
<body>

<h1><p id="header">Enter Access Key</p></h1>
<div class="login-box">
    <input type="text" id="accessKey" placeholder="7-character key">
    <button onclick="login()">Submit</button>
</div>

<div class="content-box">
    <h2>Folder: <span id="folderName"></span></h2>
    <div class="image-grid" id="imageGrid"></div>
    <div class="notice" id="notice"></div>
</div>

<script>
    // Get the folder name from the URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const folderName = urlParams.get('name');
    
    document.getElementById('folderName').innerText = folderName;

    function cleanKey(key) {
        // Ensure no hidden characters, and trim whitespaces
        return key.replace(/[\r\n]+/gm, '').trim();
    }

    function login() {
        const enteredKey = cleanKey(document.getElementById('accessKey').value); // Clean the entered key

        console.log("Entered Key: ", enteredKey);  // Log the entered key for debugging

        // Fetch the correct key for this folder from the ans/keys folder
        fetch(`../ans/keys/${folderName}.txt`)
            .then(response => response.text())
            .then(correctKey => {
                const cleanCorrectKey = cleanKey(correctKey);  // Clean the fetched key
                console.log("Correct Key: ", cleanCorrectKey);  // Log the correct key for debugging

                if (enteredKey === cleanCorrectKey) {
                    displayFolderContents(folderName); // Pass folderName to load contents
                    document.getElementById("header").innerText = `Answers inside /${folderName}`
                } else {
                    alert('Invalid access key!');
                }
            });
    }

    function displayFolderContents(folderName) {
        document.querySelector('.login-box').style.display = 'none';
        document.querySelector('.content-box').style.display = 'block';
        document.querySelector('.image-grid').style.display = 'flex';
        document.querySelector('.notice').style.display = 'block';

        // Load images (replace with actual image file names inside the folder)
        const images = ["pic.jpg", "pic2.jpg", "pic3.jpg"];  // Replace with actual filenames
        const imageGrid = document.getElementById('imageGrid');

        images.forEach(img => {
            const imgElem = document.createElement('img');
            imgElem.src = `${folderName}/${img}`;  // Use folderName in the image path
            imageGrid.appendChild(imgElem);
        });

        // Load notice.txt
        fetch(`${folderName}/notice.txt`)
            .then(response => response.text())
            .then(text => {
                document.getElementById('notice').innerText = text;
            });
    }

    console.log("Folder Name: ", folderName); // Log folder name for debugging
</script>

</body>
</html>